<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="data:;base64,=">
<script  type="text/javascript"  src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<link    href="https://cdnjs.cloudflare.com/ajax/libs/nanogallery2/3.0.5/css/nanogallery2.min.css" rel="stylesheet" type="text/css">
<link    href="https://cdnjs.cloudflare.com/ajax/libs/nanogallery2/3.0.5/css/nanogallery2.woff.min.css" rel="stylesheet" type="text/css">
<script  src="https://cdnjs.cloudflare.com/ajax/libs/nanogallery2/3.0.5/jquery.nanogallery2.min.js" type="text/javascript" ></script>
</head>
<body style="background-color: rgb(17, 17, 17); ">
<div id="nanogallery2">Made with nanogallery2</div>
<script>
/* global $ */

$(document).ready(init);

const photos_extensions = new Set([ "jpeg", "jpg", "png", "mov", "avi", "mp4" ]);

function init() {
    var args = uri_args();

    var qs = new URLSearchParams({ ...args, delimiter: "/" });
    $.post("/fs?"+qs)
    .then(data => {
        var res = {
            thumbnailHeight:  "auto",
            thumbnailWidth:   150,
            itemsBaseURL:     'https://kusers.s3.eu-west-3.amazonaws.com/' + data.Prefix,
            items: [],
            thumbnailLabel: { display: true, position:'onBottomOverImage', hideIcons: true, titleFontSize: '0.75em', align: 'left', titleMultiLine:false, displayDescription: false },
            thumbnailHoverEffect2: 'label_font-size_0.75em_1.5em|title_backgroundColor_rgba(255,255,255,0.34)_rgba(((35,203,153,0.8)|title_color_#000_#fff|image_scale_1.00_1.10_5000|image_rotateZ_0deg_4deg_5000',
            galleryTheme : { 
                thumbnail: { titleShadow : 'none', titleColor: '#fff', borderColor: '#333' },
            },
        };
        for (var item of data.Contents) {
            if (item.Size == 0)
                continue;
        	var ext = item.Key.split(".").pop().toLowerCase();
        	if (!photos_extensions.has(ext)) 
            	continue;

            var src = item.Key.substr(data.Prefix.length);
            var srct = ".thumbs/" + src;
            var title = url_to_title(item.Key);
            res.items.push({ src, srct, title });
        }
        return res;
    })
    .then(data => {
        console.log("nanogallery2 init");
        $("#nanogallery2").nanogallery2(data);
    });
}

function url_to_title(url) {
	var title = url.split("/").pop();
	title = title.split("."); title.pop(); title = title.join(".");
	if (title.indexOf(" ") == -1)
	    return "";
	return title;
}

function uri_args() {
	var tmp = window.location.search.substr(1).split('&');
	var kv = {};
	for (var i=0; i<tmp.length; i++) {
		var key = tmp[i].split('=', 1)[0];
		var val = tmp[i].substr(key.length+1);
		kv[key] = val ? decodeURIComponent(val) : val;
	}
	return kv;
}

</script>
</body>
</html>